<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMDR BLS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #E3E3E3;
            overflow: hidden;
            flex-direction: column;
            font-family: 'Arial', sans-serif;
        }
        #controlPanel {
            background-color: #FFF;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .setting-group {
            margin-bottom: 20px;
        }
        .setting-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .setting-group input[type="color"], .setting-group input[type="range"], .setting-group input[type="number"] {
            width: 100%;
        }
        .direction-buttons {
            display: flex;
            justify-content: space-between;
        }
        .direction-buttons button {
            width: 22%;
            padding: 10px;
            background-color: #FFF;
            border: 1px solid #CCC;
            cursor: pointer;
            border-radius: 5px;
            font-size: 1.2em;
        }
        #inviteLinkSection {
            margin-top: 20px;
            display: none;
        }
        #inviteLinkSection input {
            width: 100%;
            padding: 10px;
            border: 1px solid #CCC;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="controlPanel">
        <div class="setting-group">
            <label for="blsColor">BLS Color</label>
            <input type="color" id="blsColor" value="#0000FF">
        </div>
        <div class="setting-group">
            <label for="bgColor">Background Color</label>
            <input type="color" id="bgColor" value="#FFFFFF">
        </div>
        <div class="setting-group">
            <label for="speed">Speed</label>
            <input type="range" id="speed" min="1" max="10" step="0.5" value="5">
        </div>
        <div class="setting-group">
            <label>Direction</label>
            <div class="direction-buttons">
                <button id="leftRightBtn"><i class="fas fa-arrows-alt-h"></i></button>
                <button id="upDownBtn"><i class="fas fa-arrows-alt-v"></i></button>
                <button id="diagonalBtn"><i class="fas fa-exchange-alt"></i></button>
            </div>
        </div>
        <button id="inviteClientBtn" class="button">Invite Client</button>
        <div id="inviteLinkSection">
            <label for="inviteLink">Invite Link</label>
            <input type="text" id="inviteLink" readonly>
        </div>
    </div>
    <div id="ball" style="position:absolute; width: 50px; height: 50px; background-color: #FF0000; border-radius: 50%; top: 50%; left: 50%; transform: translate(-50%, -50%);"></div>
    <audio id="leftSound" src="left.wav"></audio>
    <audio id="rightSound" src="right.wav"></audio>
    <audio id="topSound" src="top.wav"></audio>
    <audio id="bottomSound" src="bottom.wav"></audio>

    <script>
        const ball = document.getElementById('ball');
        const blsColorInput = document.getElementById('blsColor');
        const bgColorInput = document.getElementById('bgColor');
        const speedInput = document.getElementById('speed');
        const inviteClientBtn = document.getElementById('inviteClientBtn');
        const inviteLinkSection = document.getElementById('inviteLinkSection');
        const inviteLinkInput = document.getElementById('inviteLink');
        const leftRightBtn = document.getElementById('leftRightBtn');
        const upDownBtn = document.getElementById('upDownBtn');
        const diagonalBtn = document.getElementById('diagonalBtn');

        let posX = window.innerWidth / 2 - 25;
        let posY = window.innerHeight / 2 - 25;
        let directionX = 1;
        let directionY = 0; // Başlangıçta yatay hareket
        let intervalId = null;

        const leftSound = document.getElementById('leftSound');
        const rightSound = document.getElementById('rightSound');
        const topSound = document.getElementById('topSound');
        const bottomSound = document.getElementById('bottomSound');

        const minDuration = 1000;
        const maxDuration = 100;
        const stepDuration = (minDuration - maxDuration) / 19; // Daha hassas hız kontrolü için

        const calculateVelocity = (speedLevel) => {
            const duration = minDuration - (speedLevel - 1) * stepDuration;
            return (window.innerWidth - 50) / (duration / (1000 / 60));
        };

        const playSound = (sound) => {
            sound.currentTime = 0;
            sound.play();
        };

        const moveBall = () => {
            const velocityX = calculateVelocity(Number(speedInput.value));
            const velocityY = calculateVelocity(Number(speedInput.value));
            posX += velocityX * directionX;
            posY += velocityY * directionY;

            if (posX <= 0) {
                directionX *= -1;
                playSound(leftSound);
            }
            if (posX + 50 >= window.innerWidth) {
                directionX *= -1;
                playSound(rightSound);
            }
            if (posY <= 0) {
                directionY *= -1;
                playSound(topSound);
            }
            if (posY + 50 >= window.innerHeight) {
                directionY *= -1;
                playSound(bottomSound);
            }

            ball.style.left = `${posX}px`;
            ball.style.top = `${posY}px`;
        };

        const startMovement = () => {
            if (intervalId) {
                clearInterval(intervalId);
                intervalId = null;
            } else {
                intervalId = setInterval(moveBall, 1000 / 60);
            }
        };

        blsColorInput.addEventListener('input', () => {
            ball.style.backgroundColor = blsColorInput.value;
        });

        bgColorInput.addEventListener('input', () => {
            document.body.style.backgroundColor = bgColorInput.value;
        });

        speedInput.addEventListener('input', () => {
            if (intervalId) {
                clearInterval(intervalId);
                intervalId = setInterval(moveBall, 1000 / 60);
            }
        });

        leftRightBtn.addEventListener('click', () => {
            directionX = 1;
            directionY = 0;
        });

        upDownBtn.addEventListener('click', () => {
            directionX = 0;
            directionY = 1;
        });

        diagonalBtn.addEventListener('click', () => {
            directionX = 1;
            directionY = 1;
        });

        inviteClientBtn.addEventListener('click', () => {
            const randomString = Math.random().toString(36).substr(2, 8);
            const inviteLink = `${window.location.origin}/session/${randomString}`;
            inviteLinkInput.value = inviteLink;
            inviteLinkSection.style.display = 'block';

            setTimeout(() => {
                inviteLinkInput.value = 'Link expired';
                inviteLinkSection.style.display = 'none';
            }, 40 * 60 * 1000); // 40 dakika sonra bağlantı geçersiz
        });

        startMovement();
    </script>
</body>
</html>
